{% extends "base.html" %}
{% load quiz_extras %}

{% block title %}Result{% endblock %}

{% block content %}
<div style="max-width:980px;margin:0 auto;padding:6px 4px;">

  <div style="display:flex;justify-content:space-between;align-items:flex-end;gap:14px;margin:8px 0 14px;flex-wrap:wrap;">
    <div>
      <h1 style="margin:0;font-size:28px;letter-spacing:-.3px;">Quiz Result</h1>
      <p style="margin:6px 0 0;font-size:14px;opacity:.85;">
        <span style="opacity:.75;">Student:</span> <b>{{ submission.student_name }}</b>
        <span style="margin:0 10px;opacity:.35;">•</span>
        <span style="opacity:.75;">Quiz:</span> <b>{{ quiz.title }}</b>
      </p>
    </div>

    <div style="display:flex;align-items:baseline;gap:8px;padding:12px 16px;border-radius:16px;
                background:rgba(37,99,235,.10);border:1px solid rgba(255,255,255,.10);min-width:140px;justify-content:center;">
      <div style="font-size:28px;font-weight:800;">{{ submission.score }}</div>
      <div style="font-size:14px;opacity:.8;">/ {{ submission.total }}</div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin:12px 0 18px;">
    <div style="background:rgba(17,24,39,.55);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;">
      <div style="font-size:12px;opacity:.75;margin-bottom:6px;">Score</div>
      <div style="font-size:16px;font-weight:700;">{{ submission.score }} / {{ submission.total }}</div>
    </div>

    <div style="background:rgba(17,24,39,.55);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;">
      <div style="font-size:12px;opacity:.75;margin-bottom:6px;">Percentage</div>
      <div style="font-size:16px;font-weight:700;">
        {% if submission.total %}
          {% widthratio submission.score submission.total 100 %}%
        {% else %}
          —
        {% endif %}
      </div>
    </div>

    <div style="background:rgba(17,24,39,.55);border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;">
      <div style="font-size:12px;opacity:.75;margin-bottom:6px;">Status</div>
      <div style="font-size:16px;font-weight:700;">
        {% if submission.total %}
          {% widthratio submission.score submission.total 100 as pct %}
          {% if pct|add:0 >= 50 %}
            <span style="padding:6px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid rgba(255,255,255,.10);background:rgba(34,197,94,.14);">
              Passed
            </span>
          {% else %}
            <span style="padding:6px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid rgba(255,255,255,.10);background:rgba(239,68,68,.14);">
              Needs Work
            </span>
          {% endif %}
        {% else %}
          —
        {% endif %}
      </div>
    </div>
  </div>

  <div style="margin:18px 0 10px;">
    <h2 style="margin:0 0 6px;">Review</h2>
    <p style="opacity:.75;margin:0;">See what you answered vs the correct answer.</p>
  </div>

  <div style="display:flex;flex-direction:column;gap:12px;">
    {% for a in answers %}
      <div style="border-radius:16px;padding:14px;border:1px solid rgba(255,255,255,.08);background:rgba(15,23,42,.70);
                  box-shadow:0 0 0 1px {% if a.is_correct %}rgba(34,197,94,.18){% else %}rgba(239,68,68,.18){% endif %} inset;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;">
          <div style="font-weight:800;font-size:12px;letter-spacing:.6px;text-transform:uppercase;opacity:.85;">
            Q{{ forloop.counter }}
          </div>
          {% if a.is_correct %}
            <span style="padding:6px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid rgba(255,255,255,.10);background:rgba(34,197,94,.14);">Correct</span>
          {% else %}
            <span style="padding:6px 10px;border-radius:999px;font-size:12px;font-weight:800;border:1px solid rgba(255,255,255,.10);background:rgba(239,68,68,.14);">Wrong</span>
          {% endif %}
        </div>

        <div style="font-size:15px;line-height:1.45;margin-bottom:12px;">
          {{ a.question.text }}
        </div>

        <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;">
          <div style="border-radius:14px;padding:12px;background:rgba(17,24,39,.55);border:1px solid rgba(255,255,255,.06);">
            <div style="font-size:12px;opacity:.75;margin-bottom:6px;">Your answer</div>
            <div style="font-weight:700;font-size:14px;line-height:1.35;">
              {{ a.question|option_text:a.selected|default:"—" }}
            </div>
          </div>

          <div style="border-radius:14px;padding:12px;background:rgba(17,24,39,.55);border:1px solid rgba(255,255,255,.06);">
            <div style="font-size:12px;opacity:.75;margin-bottom:6px;">Correct answer</div>
            <div style="font-weight:700;font-size:14px;line-height:1.35;">
              {{ a.question|option_text:a.question.correct_option }}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

  <div style="margin-top:18px;display:flex;gap:12px;flex-wrap:wrap;">
    <a href="{% url 'student_dashboard' %}" class="btn secondary">⬅ Back to Dashboard</a>
    <a href="{% url 'home' %}" class="btn">➕ Take Another Quiz</a>
  </div>

</div>
{% endblock %}
